# ONA config

topics:
  input:
    lidar: /ona2/sensors/pandar_front/cloud
    imu: /ona2/sensors/imu_front/imu
  # output:

num_threads: 20 # OpenMP threads (will be equal to $(nproc) if it is set higher)

sensor_type: 2  # LiDAR type (0: OUSTER \ 1: VELODYNE \ 2: HESAI \ 3: LIVOX)

debug: true     # save useful intermediate pcl (pc2match, deskewed...)
verbose: true   # print debug/performance board

estimate_extrinsics: true   # continuous estimation of LiDAR-IMU extrinsics 
time_offset: true           # whether to take into account the offset between sweep reference time and first point timestamp

calibration:  # automatic IMU calibration
  gravity_align: true     # estimate gravity vector
  accel: true             # estimate lin. accel. bias
  gyro: true              # estimate ang. vel. bias
  time: 3.0               # [s] time to estimate (during this time, the robot must be at stand still)

extrinsics: # w.r.t baselink [SI]
  imu:
    t: [ 0.87, 0.44, 0.17 ]
    R: [ 1.,  0.,  0.,
          0.,  1.,  0.,
          0.,  0.,  1. ]
  lidar:
    # t: [ 0.395,  -0.885,  0.201 ]
    t: [ 0.87,  -0.44,  0.201 ]
    R: [ 0.774, -0.633, 0.022,
        0.633, 0.774,  -0.026,
        -0.0005, 0.03,  0.999 ] # +40ยบ
    # R: [ 0.774, 0.633, -0.0005,
    #     -0.633, 0.774,  0.03,
    #     0.022, -0.026,  0.999 ] # -40ยบ

intrinsics:
  accel:
    bias: [ 0.01, 0.01, 0.01 ]  # [m/s^2]
    sm:   [ 1.,  0.,  0.,
            0.,  1.,  0.,
            0.,  0.,  1. ]
  gyro:
    bias: [ 0.01, 0.01, 0.01 ]  # [rad/s]

filters:
  cropBox: # prism crop
    active: true
    box:
      min: [ -1.0, -1.0, -1.0 ]  # [m]
      max: [ 1.0, 1.0, 1.0 ]     # [m]

  voxelGrid:
    active: true
    leafSize: [ 0.5, 0.5, 0.5 ]

  minDistance: # sphere crop
    active: true
    value: 3.0  # [m]
  
  rateSampling: # quick downsample
    active: false
    value: 4

iKFoM:  # Iterative Kalman Filter on Manifolds lib
  MAX_NUM_ITERS: 2                # max num+1 of iterations of the KF (limits comp. load)
  MAX_NUM_MATCHES: 5000           # max num of matches to account for when computing Jacobians (limits comp. load)
  MAX_NUM_PC2MATCH: 1.e+4         # max num of points to consider when matching with map (limits comp. load)
  LIMITS: 0.001                     

  Mapping:
    NUM_MATCH_POINTS: 5           # num of points that constitute a match
    MAX_DIST_PLANE: 2.0           # [m] max distance between points of every match
    PLANES_THRESHOLD: 5.0e-2      # threshold to consider if match points are part of a plane (also used in deciding whether a point is part of a plane) 
    LocalMapping: true            # whether to keep a fixed size map (moving with the robot) or a limitless map (when active, it limits the memory in use)
    
  iKDTree: # Incremental KD Tree lib
    balance: 0.6      # tree balancing param
    delete: 0.3       # tree deletion param
    voxel: 0.2        # downsampling value
    bb_size: 300.0    # [m] Local Map's bounding box dimension
    bb_range: 200.0   # [m] Local Map's bounding box moving range (if the robot is closer than bb_range to any local map edge, the BB will move)

  covariance:
    gyro: 0.0001 
    accel: 0.01
    bias_gyro: 0.00001
    bias_accel: 0.0001

onethread:
  delay: 0.1
  intervals: [4.0, 5.5]
  deltas:    [0.1, 0.05, 0.02]